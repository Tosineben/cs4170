<!--
    Alden Quimby
    adq2101@columbia.edu
    describe the page here
    uses jquery
    uses bootstrap for ui components
    list any influences for design
 -->
<!DOCTYPE html>
<html lang="en">
    
    <head>
        <meta charset="utf-8">
        <title>Movie Reviews</title>
        <meta name="description" content="Awesome movie review site" />
        <meta name="author" content="Alden Quimby">
        <link rel="shortcut icon" href="Images/favicon.ico" type="image/x-icon" />

        <!-- stylesheets -->
        <link href="Styles/bootstrap/bootstrap.min.css" type="text/css" rel="stylesheet" />
        <link href="Styles/bootstrap/bootstrap-responsive.min.css" type="text/css" rel="stylesheet" />
        <link href="Styles/movies.css" type="text/css" rel="stylesheet" />
        <style type="text/css">
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
            .sidebar-nav {
                padding: 9px 0;
            }
        </style>
    </head>

    <body>

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="Default.html">Movie Reviews</a>
                    <div class="nav-collapse collapse">

                        <p class="navbar-text pull-right">
                            Super awesome movie reviews, by <a href="http://www.nytimes.com/pages/movies/index.html" target="_blank" class="navbar-link">NYT</a>
                        </p>

                        <ul class="nav">
                            <li class="active">
                                <a href="Default.html">Home</a>
                            </li>
                            <li>
                                <a href="Default.html">About</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" id="drop2" role="button" class="dropdown-toggle" data-toggle="dropdown">Dropdown 2 <b class="caret"></b></a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="drop2">
                                    <li><a tabindex="-1" href="#">Action</a></li>
                                    <li><a tabindex="-1" href="#">Another action</a></li>
                                    <li class="divider"></li>
                                    <li class="nav-header">Nav header</li>
                                    <li><a tabindex="-1" href="#">Separated link</a></li>
                                    <li class="dropdown-submenu">
                                        <a tabindex="-1" href="#">More options</a>
                                        <ul class="dropdown-menu">
                                            <li><a tabindex="-1" href="#">Cool Shit</a></li>
                                            <li><a tabindex="-1" href="#">Less Cool Shit</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>

                        <form class="navbar-form">
                            <div class="input-prepend input-append">
                                <span class="add-on">
                                    <i class="icon-search"></i>
                                </span>
                                <input type="text" class="input-large search-query" id="navSearchQuery" placeholder="Search titles, genres, actors, etc.">
                                <button type="submit" class="btn" id="navSearchButton" onclick="return false;">Search</button>
                            </div>
                        </form>
                        
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row-fluid">
<!--                <div class="span2">
                    <div class="well sidebar-nav">
                        <ul class="nav nav-list">
                            <li class="nav-header">Sidebar</li>
                            <li class="active"><a href="#">Link</a></li>
                            <li><a href="#">Link</a></li>
                            <li class="nav-header">Sidebar</li>
                            <li><a href="#">Link</a></li>
                            <li><a href="#">Link</a></li>
                            <li class="nav-header">Sidebar</li>
                            <li><a href="#">Link</a></li>
                            <li><a href="#">Link</a></li>
                        </ul>
                    </div>
                </div>-->
                <div class="span12">
                    <div class="hero-unit" id="primaryMovie">
                        <h1>Hello, world!</h1>
                        <p class="movie-description">This is a template for a simple marketing or informational website. It includes a large callout called the hero unit and three supporting pieces of content. Use it as a starting point to create something more unique.</p>
                        <p><a class="btn btn-primary btn-large">Learn more »</a></p>
                    </div>
                    <div class="row-fluid">
                        <div class="span6">
                            <h2>Heading</h2>
                            <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                            <p><a class="btn" href="#">View details »</a></p>
                        </div>
                        <div class="span6">
                            <h2>Heading</h2>
                            <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                            <p><a class="btn" href="#">View details »</a></p>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span4">
                            <h2>Heading</h2>
                            <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                            <p><a class="btn" href="#">View details »</a></p>
                        </div>
                        <div class="span4">
                            <h2>Heading</h2>
                            <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                            <p><a class="btn" href="#">View details »</a></p>
                        </div>
                        <div class="span4">
                            <h2>Heading</h2>
                            <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                            <p><a class="btn" href="#">View details »</a></p>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <form class="form-horizontal">
                            <legend>Crazy form</legend>
                            <div class="control-group">
                                <label class="control-label" for="inputEmail">Email</label>
                                <div class="controls">
                                    <div class="input-prepend">
                                        <span class="add-on">
                                            <i class="icon-envelope"></i>
                                        </span>
                                        <input class="input-medium" id="inputEmail" type="text" placeholder="Enter your email address">
                                    </div>
                                    <span class="help-inline">Must have @ symbol dood</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label" for="inputGenre">Genre</label>
                                <div class="controls">
                                    <select class="span2" id="inputGenre">
                                        <option>Comedy</option>
                                        <option>Horror</option>
                                    </select>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls">
                                    <label class="checkbox">
                                        <input type="checkbox">
                                        Remember me
                                    </label>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Do It Up</button>
                                <button type="button" class="btn">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <hr>

            <footer>
                <p>© Sept 2012 - Alden Quimby</p>
            </footer>

        </div>

        <!-- scripts -->
        <!-- at bottom so page loads quick -->
        <script src="Scripts/jquery/jquery-1.8.1.js" type="text/javascript"></script>
        <script src="Scripts/bootstrap/bootstrap.js" type="text/javascript"></script>
        <script src="Scripts/adq.module.js" type="text/javascript"></script>
        <script src="Scripts/movies.js" type="text/javascript"></script>
        
<!--        <iframe id="blahBlah" style="display:none;" src="http://api.nytimes.com/svc/movies/v2/reviews/search?api-key=bd2994d7e713ac0c7c58f238661910bb:19:64484326&query=test"></iframe>-->

        <script type="text/javascript">

            (function (module) {

                module.search = {

                    init: function (settings) {
                        var self = this;
                        self.settings = settings;

                        $('#navSearchButton').click(function () {
                            var query = $('#navSearchQuery').val().trim();

                            if (query == '') {
                                // no search
                                return;
                            }

                            var data = {
                                offset: null,
                                order: null,
                                query: query,
                                'critics-pick': null,
                                'thousand-best': null,
                                dvd: null,
                                reviewer: null,
                                'publication-date': null,
                                'opening-date': null,
                            };

                            //offset, order, query, criticsPick, thousandBest, dvd, reviewer, pubDate, openDate
                            var url = self.settings.getSearchUrl();
                            //url += "&callback=?";

                            //$.ajax(url, {
                            //    type: "get",
                            //    data: data,
                            //    dataType: "jsonp",
                            //    success: self.onSearchSuccess,
                            //    error: self.onSearchError,
                            //});

                            self.onSearchSuccess(searchData);

                        });
                    },

                    onSearchSuccess: function (resp, fake) {
                        resp = searchData; //TEMP HACK

                        var self = this;
                        debugger;

                        if (resp.status != "OK") {
                            alert(resp.status);
                            return;
                        }

                        self.displayPageNumbers(searchData.num_results);
                        self.displaySearchResults(searchData.results);
                    },
                    
                    onSearchError: function (resp, fake) {
                        debugger;
                    },
                    
                    displaySearchResults: function(results){
                        results = searchData.results; //TEMP HACK

                        var self = this;

                        if (!results || results.length == 0) {
                            alert('No results!');
                            return;
                        }

                        var topResult = results[0];
                        var title = topResult.display_title;
                        var headline = topResult.headline;
                        var summary = topResult.summary_short;
                        var reviewPubDate = topResult.publication_date;
                        var openedInTheatresDate = topResult.opening_date;
                        var dvdReleaseDate = topResult.dvd_release_date;
                        var rating = topResult.mpaa_rating;
                        var isCriticsPick = topResult.critics_pick;
                        var isThousandBest = topResult.thousand_best;
                        var reviewerName = topResult.byline;
                        var reviewSnippet = topResult.capsule_review;
                        var reviewUrl = topResult.link.url;
                        var reviewerBioUrl = self.settings.getBioUrl(reviewerName);

                        var img = topResult.multimedia.resource;
                        
                        if (img.type == "thumbnail") {
                            // use for all results except hero
                            var src = img.src;
                        }

                        //TODO: add links for related urls

                        var primary = $('#primaryMovie');
                        primary.children('h1').html(topResult.display_title);
                        
                    },
                    
                    displayPageNumbers: function (numResults) {
                        numResults = searchData.num_results; //TEMP HACK

                    },
                };

            })(adq.module('movieReviews'));

            (function () {

                $(function () {

                    var baseUrl = 'http://api.nytimes.com/svc/movies/v2';

                    var settings = {
                        apiKey: 'bd2994d7e713ac0c7c58f238661910bb:19:64484326',
                        getSearchUrl: function () {
                            return baseUrl + '/reviews/search?';  
                        },
                        getBioUrl: function (reviewerName) {
                            return baseUrl + '/critics/' + reviewerName.replace(' ', '-') + '?';
                        },
                    };

                    adq.module('movieReviews').search.init(settings);
                });

            })();

        </script>

    </body>

</html>
